## Lab 01-01


## 1. Upload the files to VirusTotal and view the reports.

**Does either file match any existing antivirus signatures?**

The VirusTotal website gives the file ‘**Lab-1-01.exe**’** the score of **55/73**.

**MD5:** `bb7425b82141a1c0f7d60e5106676bb1` 

**SHA-256**: `58898bd42c5bd3bf9b1389f0eee5b39cd59180e8370eb9ea838a0b327bd6fe472`

The VirusTotal website gives the file ‘**Lab-1-01.dll’** the score of **38/73**.

**MD5:** `290934c61de9176ad682ffdd65f0a669`

**SHA-256**: f50e42c8dfaab649bde0398867e930b86c2a599e8db83b8260393082268f2dba*

## 2. When were these files compiled?

The file ‘**Lab-1-01.exe’** was compiled at Sun Dec 19 16:16:19 2010.

The file ‘**Lab-1-01.dll’** was compiled at Sun Dec 19 16:16:38 2010.

## 3. Are there any indications that either of these files is packed or obfuscated?

Let’s take a look at first file.

It has three of the section headers

- .text – the virtual size (0x00000970) is the same as the raw size (0x00001000), even smaller.
- .rdata – the virtual size (0x000002B2) is not the same as the raw size (0x00001000)
- .data – the virtual size 0x000000FC is the same as the raw size. 0x00001000), even smaller.

The sizes give us a sign that the analyzed file is not packed.


The analyze of library ‘KERNEL32.dll’ provides us info that it uses 10 functions, and none of them is a LoadLibrary or GetProcAdress, so another proof of not being packed.
At the end I checked the file with another tool called ‘TrIDNET’. That application tells us what the file consists of based on its definition list.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/95d8ddd6-b2a7-4b37-a538-e9310d3960bc)


There’s no indicator that the file is packed.


It has three of the section headers:
**1. .text** – the virtual size (0x0000039E) is smaller than the raw size (0x00001000).

**2. .rdata** – the virtual size (0x00023FC6) is the same as the raw size (0x00024000)

**3. .data** – the virtual size (0x0000006C) is smaller than the raw size (0x00001000).

The sizes of the .dll file give us a hint that the file might not be packed.



The upload into ‘TrIDNET’ also confirms that:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/81cd57fe-6421-488c-bfac-409657ca4b70)


## If so, what are these indicators?

There are no indicators telling that either any of these files might be packed or obfuscated.

## 4. Do any imports hint at what this malware does? If so, which imports are they?**
‘Lab-1-01.exe’ imports three libraries: ‘KERNEL32.dll’, ‘MSVCRT.dll’ and ‘Lab01-01.dll’. It does not have any exports.

**a) KERNEL32.dll**
There are not that many of the imports in KERNEL32.dll, so I will list and analyze all of them:

- CreateFileA - Creates or opens a file or I/O device.
- FindClose - Closes a file search handle opened by the FindFirstFile, FindFirstFileEx etc, which might be useful for the next imports.
- FindNextFileA – Function to search through catalogues.
- FindFirstFileA - Function to search through catalogues.
- CopyFileA – Copies an existing file to a new file, might be used to hide the malware to re-run during the system startup.
- CreateFileMappingA- Function to inject into a file, might be used for process modification or some kind of launcher.
- MapViewOfFile – Similar function to the one above, used to injection, launchers, with proper usage it can avoid using WriteFile for file modification.
- UnmapViewOfFile – Used to disconnect from mapping a process ie. deinjection.
- CloseHandle – used for closing the calls.
- IsBadReadPtr – checks if the calling process has read access to all bytes in specified memory range.

Based on the functions above we can tell that the potential malware can recreate itself under a new name, can search through the files, modify or hide under the other processes and save the gathered information somewhere on the computer.

**b) MSVCRT.dll** –the file is related to Microsoft C Runtime Library. The file loads modules for Visual C and C++ programs.

**c)** **Lab-1-01.dll –** additional .dll file that was generated for proper functions usage of the ‘Lab01-01.exe’ executable.

The Lab-1-01.dll splits into three libraries:

- KERNEL32.dll
- WS2\_32.dll
- MSVCRT.dll

KERNEL32.dll:

- Sleep – time interval for which execution is to be suspended, in milliseconds.
- CreateProcessA – creates a new process.
- CreateMutexA – creates a mutex, can be used by malware to ensure that only one instance of malware is running at the same time. It can be a good host based indicator that we should look for on a infected computer.
- OpenMutexA – opens a mutex connection, same as above.
- CloseHandle - used for closing the calls.


**WS2_32.dll** – Windows Sockets 2 library, enables malware to establish a network connection, download and send data.

**MSVCRT.dll** –same as previously explained - file is related to Microsoft C Runtime Library. The file loads modules for Visual C and C++ programs

## 5. Are there any other files or host-based indicators that you could look for on infected systems?

On the infected system you should be looking for a newly created files, especially the ones that attach into other running processes. We should also look for malware mutex names, since there is a high probability that only one instance of malware might be running at one time.

Running the PE file through tool String gives us a hint that the malware can be named ‘kerne132.dll’ trying to intimidate the ‘kernel32.dll’ with a similar name.

## 6.What network-based indicators could be used to find this malware on infected machines?

We should look for a strange connection addresses, and what kind of files are being sent over.

Checking the strings inside the ‘Lab-1-01.dll’ gives us a hint of the potential IP address: 127.26.152.13.

A good idea might be to stop network connection, and run tool like FakeNET.

## 7. What would you guess is the purpose of these files?

The purpose of these files is clearly to infect a computer, hide itself and in the meantime scan through all of the files, processes. After gathering all of the needed information – send it over network.
