## Lab 01-04

##  1. Upload the Lab01-04.exe file to VirusTotal. Does it match any existing antivirus definitions?

**MD5:** `625ac05fd47adc3c63700c3b30de79ab`

**SHA-256:** `0fa1498340fca6c562cfa389ad3e93395f44c72fd128d7ba08579a69aaf3b126`

Currently the virustotal gives the file score of 66/73.

##  2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.

- Section headers (.text, .rdata, .data, .rsrc) are visible
- Virtual size of each section is smaller than raw size
- KERNEL32.dll has 16 imports, ADVAPI32.dll has 3 imports, MSVCRT.dll has 15 imports.
- There are a lot of strings that contain function names, potential malware url’s, none of them seem obfuscated.

## 3. When was this program compiled?

The program was compiled at Fri Aug 30 22:26:59 2019. 

Knowing the fact that the examples were created before the book got published (2012) – it means that the compilation date was spoofed.

## 4. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?

There are three libraries:

**1) KERNEL32.dll**
- GetProcAddress
- LoadLibraryA
- WinExec – used for opening another executable.
- WriteFile
- CreateFileA
- SizeofResource
- CreateRemoteThread – malware uses that function to run a thread in remote process. Mostly popular in hidden code injection into a process.
- FindResourceA – it tells us that malware might store some data in the executable resources.
- GetModuleHandleA
- GetWindowsDirectoryA – used for installing malicious programs in the Windows directory.
- MoveFileA
- GetTempPathA
- GetCurrentProcess 
- OpenProcess
- CloseHandle
- LoadResource

**2) ADVAPI32.dll**
- OpenProcessToken – checking actual privileges of the process.
- LookupPrivilegeValueA – used for gaining more privilege.
- AdjustTokenPivileges – as above, used for manipulating privileges. 

**3) MSVCRT.dll**

**4) URLMON.dll** (dynamically added)
- URLDownloadToFileA

Based on listed above imports, we can tell that the malicious file is capable of creating a file, rename it, run other executable, attach into other processes, change privileges, install malicious files into Windows directory. It is also capable of downloading a file from an URL address.

## 5. What host- or network-based indicators could be used to identify this malware on infected machines?

Host-based indicator – the malware might be hiding under a name ‘winup.exe’, it can be also hidden in system32 folder under a name **‘wupdmgr.exe’**

Network-based indicator – malware downloads a file from an URL address: http://www.practicalmalwareanalysis.com/updater.exe


## 6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?

Examining the resources in CFF Explorer, we can confirm our conclusions from reading the strings. 
The file has additional dynamically attached library called ‘URLMON.dll’ that uses function URLDownloadToFileA.

Also it shows us that the file holds information in the resources for three functions: **‘WinExec’**, **‘GetTempPathA’** and **‘GetWindowsDirectoryA’**
