## Lab 03-01

**When I started to analyze that malware, I couldn’t make it work on Windows 10, looking through the internet I got to know that I need to run it in Windows XP environment.**

**These and further labs are going to be analyzed in Windows XP x86 SP3 environment.**

## 1. What are this malware’s imports and strings?

A quick peek into a PEID shows us that the file is encrypted:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/89d9cf9c-fc3c-4276-9a47-5484f3269f33)

Browsing the internet in order to find some information about PEncrypt 3.1 led me to the conclusion that it’s a software written around 2000s to protect the software from curious people.

CFF Explorer tells us that there is only one imported library: kernel32.dll, that uses function ‘ExitProcess’. 



Let’s take a look at strings:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/d2c7a515-63df-436b-a919-eb155bda8dfa)


There are some interesting strings like:

- ws2\_32 – network library
- CONNECT  %s:%i HTTP/1.0
- advapi32 – registry library
- ntdll – exports windows native API
- user32 –user interface
- advpack – part of OS
- vmx32to64.exe – there is no such file at the windows, might be a hint that it might be cloned malware under a new name to restart itself on each reboot.
- registry addresses – might be a hint of what the malware wants to do

## 2. What are the malware’s host-based indicators?

Procmon analysis:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/b58380c8-e2b8-4ab8-9e5d-8fba0c06f222)


Malware creates several files on system32 directory. Most of them are library files and only one .exe file ‘vmx32to64.exe’ which we found earlier in strings analysis.

Checking the original **‘lab-03-01.exe’** file with a newly created **‘vmx32to64.exe’** with HashMyFiles shows that these files are identical.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/7c570996-cff7-4a01-b763-36827737d27b)



I also found that the malware uses mutex to avoid running multiple times same virus instance.
The mutex is called ‘WinVMX32’.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/a59afcd5-a647-431b-b5ad-74cf82531de8)


To summarize:

- Finding the new filename ‘vmx32to64’ in static string analysis, and then finding the created file in system32 directory means that there is a high probability that the malware will always create a file with this specific name.
- Finding mutex ‘WinVMX32’ is a clear sign that malware has infected the PC.

## 3. Are there any useful network-based signatures for this malware? If so, what are they?

Analyzing the network with FakeNET gives me information that malware is trying to connect the website: [www.practicalmalwareanalysis.com](http://www.practicalmalwareanalysis.com)

It could be a good signature to look for.
