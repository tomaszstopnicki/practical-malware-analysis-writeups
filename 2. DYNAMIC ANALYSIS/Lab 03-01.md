## Lab 03-01

**When I started to analyze that malware, I couldn’t make it work on Windows 10, looking through the internet I got to know that I need to run it in Windows XP environment.**

**These and further labs are going to be analyzed in Windows XP x86 SP3 environment.**

## 1. What are this malware’s imports and strings?

A quick peek into a PEID shows us that the file is encrypted:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/a2b47eef-056f-453d-8a94-3125284f5e7d)


Browsing the internet in order to find some information about PEncrypt 3.1 led me to the conclusion that it’s a software written around 2000s to protect the software from curious people.

CFF Explorer tells us that there is only one imported library: kernel32.dll, that uses function ‘ExitProcess’. 



Let’s take a look at strings:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/3ab50acd-4f5f-43f2-b4a4-0ffea89483fe)


There are some interesting strings like:

- ws2\_32 – network library
- CONNECT  %s:%i HTTP/1.0
- advapi32 – registry library
- ntdll – exports windows native API
- user32 –user interface
- advpack – part of OS
- vmx32to64.exe – there is no such file at the windows, might be a hint that it might be cloned malware under a new name to restart itself on each reboot.
- registry addresses – might be a hint of what the malware wants to do

## 2. What are the malware’s host-based indicators?

Procmon analysis:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/aeea3f16-80ca-4903-9565-039dbd54d1f3)

Malware creates several files on system32 directory. Most of them are library files and only one .exe file ‘vmx32to64.exe’ which we found earlier in strings analysis.

Checking the original **‘lab-03-01.exe’** file with a newly created **‘vmx32to64.exe’** with HashMyFiles shows that these files are identical.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/533a095d-174c-47ba-b505-5258d359b90f)


I also found that the malware uses mutex to avoid running multiple times same virus instance.
The mutex is called ‘WinVMX32’.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/3e05aa85-8f1a-4b2e-843e-0bd1a30167a5)

To summarize:

- Finding the new filename ‘vmx32to64’ in static string analysis, and then finding the created file in system32 directory means that there is a high probability that the malware will always create a file with this specific name.
- Finding mutex ‘WinVMX32’ is a clear sign that malware has infected the PC.

## 3. Are there any useful network-based signatures for this malware? If so, what are they?

Analyzing the network with FakeNET gives me information that malware is trying to connect the website: [www.practicalmalwareanalysis.com](http://www.practicalmalwareanalysis.com)

It could be a good signature to look for.
