## Lab 06-04
In this lab, we’ll analyze the malware found in the file Lab06-03.exe.

## 1. What is the difference between the calls made from the main method in Labs 6-3 and 6-4?

There are no outside differences between calls made from the main method beside different subroutine names in two places: 0x00401130 and 0x00401150.

## 2. What new code construct has been added to main? 

We have a for loop after success of checking connection state. The limit of the for loop is set to reach a number of 1440 and it is incremented by 1 each time. 

In the for loop we have a calls from the previous exercise such as reading the payload in .htm, printing the result, setting a persistence of cc.exe and after that calling a sleep for 60 seconds.

## 3. What is the difference between this lab’s parse HTML function and those of the previous labs?

In the Lab06-04.exe we have a usage of an User Agent “Internet Explorer 7.50/pma%d” that gets used in a InternetOpenA call.

## 4. How long will this program run? (Assume that it is connected to the Internet.)

Well, let’s search for all Sleep functions, using xrefs we can find that there are two calls to a sleep function, one is at setting persistency function, at x004011F9 and it takes a 100 seconds to complete, and the second one is almost at the end of the for loop iteration, just before the increment of a counter, the second Sleep takes 60 seconds.

While we can’t really tell what will be the arguments to trigger the first Sleep so we can’t really count it up, but we can surely count the Sleep’s in a for loop. The instruction is JGE 1440 (Jump greater or equal) and our starting point is a 0.

So, assuming the internet connection is positive, the program will take 1440 iterations of 1 minute each, that will mean it will take around 1440 minutes or around 24 hours to complete, assuming that there is no letter E (first sleep call).

## 5. Are there any new network-based indicators for this malware?

As a new network-based indicator we can take an User Agent “Internet Explorer 7.50/pma%d”.

## 6. What is the purpose of this malware?

This malware is intended to check for the network status, loads a command using a html and proceed with it. The commands are intended to preserve existence of the malware upon system restart by coping a file into hiding spot and entering the registry key for auto-run. After a run, the malware is intended to work 24 hours waiting for new commands from the author.
