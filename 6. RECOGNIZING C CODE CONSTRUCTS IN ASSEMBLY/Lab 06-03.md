## Lab 06-03

In this lab, we’ll analyze the malware found in the file Lab06-03.exe

## 1. Compare the calls in main to Lab 6-2’s main method. What is the new function called from main?

In Lab06-03.exe main part we can find a new call to sub_401130. 

![image](https://github.com/user-attachments/assets/13c1b39d-4707-44d2-9781-279741ea65fd)


## 2. What parameters does this new function take?

Before the call, two parameters are set on the stack. A char, and a LPCSTR lpExistingFileName (a pointer to a string).

A char is the HTML symbol downloaded from a previous call to 0x401040.

lpExistingFileName is argv[0] which is a name of the file.

## 3. What major code construct does this function contain?

In the subroutine we can see a switch jump table that substracts ascii value 61 (‘a’) from a var\_8 char (html symbol downloaded from previous exercise in sub\_401040.

Switch has 5 cases: 0, 1, 2, 3, 4. If in var\_8 we have a value a (61 ascii), then the result is 0 and that goes to case 0. 

If the result is b (62 ascii), then 62-61 = 1 which results in jumping to case 1.

The exit path is at 0x0040114A when the result of substraction is above 4 and that

means that the malware author is looking for inputs of letters: a, b, c, d, e.

Any other letter leads to the exit path.


## 4. What can this function do?

The possibilities of this function:

- loc_40115A (input letter **a**) – creates a directory called **Temp** at **C:\\**
- loc_40116C (input letter **b**) – create a copy of the current running program to **C:\\Temp\\** at name **cc.exe**
- loc_40117F (input letter **c**) – deletes a cc.exe file at **C:\\Temp\\**
- loc_40118C (input letter **d**) – creates a registry entry **C:\\Temp\\cc.exe** under a name **Malware** at Software\\Microsoft\\Windows\\CurrentVersion\Run to preserve action of the malware after a system restart. The second part applies if RegSetValueExA is unsuccessful and prints: Error 3.1: Could not set Registry value.
- loc_4011D4 (input letter **e**) – puts a malware into sleep with an interval of 100000ms (100 seconds)

## 5. Are there any host-based indicators for this malware?

Yes, there are a few host-based indicators.

- File called cc.exe hiding at C:\\Temp.
- Registry entry C:\\Temp\\cc.exe with a ValueName of Malware under Software\\Microsoft\\Windows\\CurrentVersion\Run.

## 6. What is the purpose of this malware?

This malware is intended to check for the network status, loads a command using a html and proceed with it. The commands are intended to preserve existence of the malware upon system restart by coping a file into hiding spot and entering the registry key for auto-run.
