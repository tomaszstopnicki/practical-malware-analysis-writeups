## Lab 03-02

## Lets do a standard static analysis.

- Quick glance at virustotal tells me that it’s some kind of trojan/backdoor malware.
- Analyzing the strings gives out a lot of information from some functions, data about installation to information about registry keys. Let’s skip it for now, and proceed to other static information.
- Checking with PEID and comparing the sizes shows us that it is not packed/secured in any way.

**Imported libraries:**

- KERNEL32.dll – creating threads, sleep function (the malware might wait before showing its functions), file manipulation.
- ADVAPI32.dll – managing registry, services.
- WS\_32.dll – just function WSASocketA, others are just numbered.
- WININET.dll (connecting to a website, opening http requests, reading file from the internet).
- MSVCRT.dll

## 1. How can you get this malware to install itself?

There are two ways to run this malware:

- First option is to install the malware we have to use the rundll32.exe with a prompt that we found in exports functions of the analyzed .dll file.
- 
  ![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/114c7f66-4314-478d-8dd5-830286e6c290)



- The other alternative is to change the PE Header IMAGE\_FILE\_DLL from **2000** to **0** and then changing the extension to an .exe to run it.

## 2. How would you get this malware to run after installation?

Analyzing the post results of .dll installation in Regshot we can see that the malware created service named **‘IPRIP’** that is network related. Getting back to analyzing the strings, we can also see that **‘IPRIP’** was listed there. 
We can also see that it is connected to svchost.exe.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/2c702290-321f-4dae-8680-0efc8ae39ca6)



Looking for the running services, I can’t find any of it, lets try to run it manually:

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/dd852e58-34cf-4792-ab0b-1d9ccb15652c)


## 3. How can you find the process under which this malware is running?

After starting the IPRIP service we can look for the information at Process Explorer using find function.

We simply type in the ‘Lab-03-02.dll’ in the ‘handle or dll substring’.

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/25797ef5-85eb-46d3-a0db-7e3e69f841ec)



We can see that the process is hiding under ‘svchost.exe’ under PID of 1056.

## 4. Which filters could you set in order to use procmon to glean information?

Since there are a lot of svchost.exe processes running we should filter the procmon for the PID of 1056.

## 5. What are the malware’s host-based indicators?

The malware creates a service in registry called **‘IPRIP’** with a description of: **Intranet Network Awareness (INA+)** and connects with svchost.exe process.

## 6. Are there any useful network-based signatures for this malware?

We have two main network-based signatures:

- Connection to the domain: practicalmalwareanalysis.com on port 80
- User-Agent: malwareanalysis Windows XP 6.11

We can see in FakeNET that the malware tries to connect to domain malwareanalysis.com

![image](https://github.com/tomaszstopnicki/practical-malware-analysis-writeups/assets/163318997/b866a0fb-cf28-4309-a12e-2f335dc23dac)



